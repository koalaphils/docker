FROM koalaphils/php:7.4-apache

RUN sed -i "s|/var/www/html|/var/www/html/public|g" /etc/apache2/sites-enabled/000-default.conf
RUN curl -sS https://get.symfony.com/cli/installer | bash
RUN mv /root/.symfony/bin/symfony /usr/local/bin/symfony

ONBUILD COPY app /var/www/html
ONBUILD RUN composer config --global use-github-api false; \
  composer config --global vendor-dir /var/www/vendor; \ 
  ln -s /var/www/vendor /var/www/html/vendor; \
  composer install --prefer-dist --no-suggest --no-interaction -ao --apcu-autoloader --no-scripts \
  ;
ONBUILD RUN sed -i "s|exec \"\$@\"||g" /usr/local/bin/docker-php-entrypoint \
  ; echo "rm -rf /var/www/html/vendor;\nln -sf /var/www/vendor /var/www/html/vendor;\ncomposer install -ao --apcu-autoloader --no-interaction;\nexec \"\$@\";" >> /usr/local/bin/docker-php-entrypoint \
  ;
